# EVE-NGç”¨Terraformãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

EVE-NGï¼ˆEmulated Virtual Environment Next Generationï¼‰ãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®Terraformãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã™ã€‚ä¿¡é ¼æ€§ã®å‘ä¸Šã¨åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

## æ©Ÿèƒ½

ã“ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯ã€å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã‚’å‚™ãˆãŸä»¥ä¸‹ã®EVE-NGãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š

### ãƒªã‚½ãƒ¼ã‚¹
- **eve_folder** - EVE-NGãƒ•ã‚©ãƒ«ãƒ€ã®ç®¡ç†
- **eve_lab** - EVE-NGãƒ©ãƒœã®ç®¡ç†
- **eve_network** - ãƒ©ãƒœãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç®¡ç†ï¼ˆå¯è¦–æ€§åˆ¶å¾¡å¯¾å¿œï¼‰
- **eve_node** - ãƒ©ãƒœãƒãƒ¼ãƒ‰ã®ç®¡ç†ï¼ˆQEMUã€Dynamipsã€IOLã€Dockerã€VPCSï¼‰
- **eve_interface_attachment** - ãƒãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æ¥ç¶šã®ç®¡ç†

### ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
- **eve_templates** - åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å–å¾—
- **eve_network_types** - åˆ©ç”¨å¯èƒ½ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ—ã®å–å¾—
- **eve_icons** - åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¤ã‚³ãƒ³ã®å–å¾—
- **eve_status** - ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å–å¾—

## æœ€è¿‘ã®æ”¹å–„

### âœ… ä¿¡é ¼æ€§ã®å‘ä¸Š
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å€‹åˆ¥èª­ã¿å–ã‚Šå¤±æ•—æ™‚ã«è‡ªå‹•çš„ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¹ãƒˆã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- **åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨é©åˆ‡ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰æ¤œè¨¼
- **å‹å®‰å…¨æ€§**: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹ã®å¤‰å‹•ã«å¯¾ã™ã‚‹å …ç‰¢ãªå‡¦ç†
- **ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°**: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã®ãŸã‚ã®åºƒç¯„ãªãƒ­ã‚°

### ğŸ›¡ï¸ å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼**: ã™ã¹ã¦ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é©åˆ‡ãªæ¤œè¨¼
- **ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†**: ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚·ãƒŠãƒªã‚ªã®æ­£ã—ã„å‡¦ç†
- **èªè¨¼**: è©³ç´°ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å«ã‚€ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç®¡ç†**: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚µãƒãƒ¼ãƒˆã‚’å‚™ãˆãŸå›å¾©åŠ›ã®ã‚ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ“ä½œ

### ğŸ¨ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¯è¦–æ€§åˆ¶å¾¡
- **éè¡¨ç¤ºãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: `visibility = "0"`ã‚’è¨­å®šã—ã¦EVE-NG GUIã‹ã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’éè¡¨ç¤º
- **ã‚¯ãƒªãƒ¼ãƒ³ãªãƒ©ãƒœã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: è¦–è¦šçš„ãªä¹±é›‘ã•ãªã—ã«æ¥ç¶šå°‚ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆ
- **ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªå¤–è¦³**: ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚¯ãƒªãƒ¼ãƒ³ãªãƒ©ãƒœå›³ã‚’ç¶­æŒ

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
2. ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ãƒ“ãƒ«ãƒ‰:
   ```bash
   make build
   ```
3. ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:
   ```bash
   make install
   ```

### ä½¿ç”¨æ–¹æ³•

```hcl
terraform {
  required_providers {
    eve-ng = {
      source = "local/eve-ng"
      version = "1.0.0"
    }
  }
}

provider "eve-ng" {
  endpoint = "http://192.168.0.101"
  username = "admin"
  password = "eve"
  insecure_skip_verify = true
}

# ãƒ©ãƒœã‚’ä½œæˆ
resource "eve_lab" "test_lab" {
  path        = "/"
  name        = "test-lab"
  author      = "Terraform"
  description = "Terraformã§ä½œæˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ©ãƒœ"
  version     = "1"
}

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆ
resource "eve_network" "net1" {
  lab_file = eve_lab.test_lab.file
  name     = "net1"
  type     = "bridge"
}

# ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§QEMUãƒãƒ¼ãƒ‰ã‚’ä½œæˆ
resource "eve_node" "linux_node" {
  lab_file       = eve_lab.test_lab.file
  name           = "linux-node"
  type           = "qemu"
  template       = "linux"
  cpu            = 2
  ram            = 2048
  qemu_version   = "2.4.0"
  qemu_arch      = "x86_64"
  qemu_nic       = "virtio-net-pci"
  qemu_options   = "-enable-kvm"
  cpulimit       = true
  desired_state  = "started"
}

# ãƒãƒ¼ãƒ‰ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶š
resource "eve_interface_attachment" "net1_connection" {
  lab_file        = eve_lab.test_lab.file
  node_id         = tonumber(split(":node:", eve_node.linux_node.id)[1])
  interface_index = 0
  target          = "network:${tonumber(split(":network:", eve_network.net1.id)[1])}"
}

# 2ç•ªç›®ã®ãƒãƒ¼ãƒ‰ã‚’ä½œæˆ
resource "eve_node" "linux_node2" {
  lab_file       = eve_lab.test_lab.file
  name           = "linux-node2"
  type           = "qemu"
  template       = "linux"
  cpu            = 1
  ram            = 1024
  qemu_version   = "2.4.0"
  qemu_arch      = "x86_64"
  qemu_nic       = "virtio-net-pci"
  qemu_options   = "-enable-kvm"
  cpulimit       = true
  desired_state  = "started"
}

# ãƒãƒ¼ãƒ‰é–“æ¥ç¶šç”¨ã®2ç•ªç›®ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆ
resource "eve_network" "connection_net" {
  lab_file   = eve_lab.test_lab.file
  name       = "connection-net"
  type       = "bridge"
  visibility = "0"  # éè¡¨ç¤ºãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆEVE-NG GUIã§è¡¨ç¤ºã•ã‚Œãªã„ï¼‰
}

# ä¸¡æ–¹ã®ãƒãƒ¼ãƒ‰ã‚’åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã—ã¦ç›´æ¥é€šä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹
resource "eve_interface_attachment" "node1_to_net" {
  lab_file        = eve_lab.test_lab.file
  node_id         = tonumber(split(":node:", eve_node.linux_node.id)[1])
  interface_index = 0
  target          = "network:${tonumber(split(":network:", eve_network.connection_net.id)[1])}"
}

resource "eve_interface_attachment" "node2_to_net" {
  lab_file        = eve_lab.test_lab.file
  node_id         = tonumber(split(":node:", eve_node.linux_node2.id)[1])
  interface_index = 0
  target          = "network:${tonumber(split(":network:", eve_network.connection_net.id)[1])}"
}
```

## é–‹ç™º

### å‰ææ¡ä»¶
- Go 1.21ä»¥é™
- Terraform 1.0ä»¥é™

### ãƒ“ãƒ«ãƒ‰
```bash
make build
```

### ãƒ†ã‚¹ãƒˆ
```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
make test

# ãƒ¬ãƒ¼ã‚¹æ¤œå‡ºã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
make test-race

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®Ÿè¡Œ
make test-unit
make test-client
make test-mock
```

### ã‚³ãƒ¼ãƒ‰å“è³ª
```bash
# ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
make fmt

# ãƒªãƒ³ã‚¿ãƒ¼ã‚’å®Ÿè¡Œ
make lint

# vetã‚’å®Ÿè¡Œ
make vet
```

## è²¢çŒ®

1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
3. å¤‰æ›´ã‚’åŠ ãˆã‚‹
4. å¤‰æ›´ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
5. ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®Ÿè¡Œ
6. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯LICENSEãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## è¬è¾

- å„ªã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æä¾›ã™ã‚‹EVE-NGã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£
- Terraformãƒ—ãƒ©ã‚°ã‚¤ãƒ³SDKã‚’æä¾›ã™ã‚‹HashiCorp
